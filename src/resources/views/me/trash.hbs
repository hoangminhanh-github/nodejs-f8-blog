<form class='mt-4 ' name="container-form" action="/courses/handleFormAction" method="post">
  <div>
    <h4 style='margin-right: 10px;'>Thùng rác</h4>
    <a href='/me/stored/courses'>Khóa học của tôi</a>
    {{!-- --}}
    <div class="mt-4 mb-2 d-flex flex-row justify-content-between align-items-center" style="width:350px">
      <div>
        <input type="checkbox" value="" id="checkbox-all">
        <label class="form-check-label" for="checkbox-all">
          Chọn tất cả
        </label>
      </div>
      {{!-- --}}
      <select class="custom-select custom-select-sm" style="width:150px" name="action" required>
        <option selected value="">---Chọn hành động---</option>
        <option value="">--Khôi phục--</option>
        <option value="force-delete">--Xóa vĩnh viễn--</option>

      </select>
      <button class="btn btn-primary btn-sm active-btn disabled " data-toggle='modal' data-target='#force-delete-course'
        type="button">Thực
        hiện</button>
    </div>
  </div>
  <table class='table table-hover'>
    <thead>
      <tr>
        <th scope='col'>#</th>
        <th scope='col'>Tên Khóa Học</th>
        <th scope='col'>Trình Độ</th>
        <th scope='col'>Thời Gian Xóa</th>
        <th></th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      {{#each courses}}
      <tr>
        <th>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="{{this._id}}" name="courseIds[]">
          </div>
        </th>
        <th scope='row'>{{sum @index 1}}</th>
        <td><a href='/courses/{{this.slug}}'>{{this.name}}</a></td>
        <td>{{this.level}}</td>
        <td>{{this.deletedAt}}</td>
        <td>
          <a href='' data-id='{{this._id}}' type='button' class='btn btn-link btn-restore'>Khôi phục</a>
          <a href="" class='btn btn-link btn-force-delete' data-toggle='modal' data-target='#force-delete-course'
            data-id='{{this._id}}'>
            Xoá vĩnh viễn
          </a>
        </td>

      </tr>
      {{else}}
      <tr>
        <td colspan='5' class='text-center'>Thùng rác trống
          <a href='/me/stored/courses/'>Các khóa học của tôi</a>
        </td>
      </tr>
      {{/each}}
    </tbody>
  </table>
</form>


{{!-- modal confirm--}}
<div class='modal fade' id='force-delete-course' tabindex='-1' role='dialog' aria-labelledby='exampleModalLabel'
  aria-hidden='true'>
  <div class='modal-dialog' role='document'>
    <div class='modal-content'>
      <div class='modal-header'>
        <h5 class='modal-title' id='exampleModalLabel'>Lưu ý</h5>
        <button type='button' class='close' data-dismiss='modal' aria-label='Close'>
          <span aria-hidden='true'>&times;</span>
        </button>
      </div>
      <div class='modal-body'>
        Xác nhận muốn xóa
      </div>
      <div class='modal-footer'>
        <button type='button' class='btn btn-danger'>Đồng ý xóa</button>
        <button type='button' class='btn btn-secondary' data-dismiss='modal'>Hủy Xóa</button>
      </div>
    </div>
  </div>
</div>






{{! hidden form }}
<form name='restore-courses-form' action='' method='post'></form>
<form name='force-delete-courses-form' action='' method='post'></form>


<script>

  document.addEventListener('DOMContentLoaded', function () {
    var form = document.forms['container-form']
    var checkboxAll = $('#checkbox-all')
    var courseItemCheckbox = $('input[name="courseIds[]"]')
    var activeBtn = $('.active-btn')
    var restoreForm = document.forms['restore-courses-form'];
    var forceDeleteForm = document.forms['force-delete-courses-form'];
    var restoreBtn = $('.btn-restore');
    var forceDeleteBtn = $('.btn-force-delete');
    var btnDelete = document.querySelector('.btn.btn-danger');

    $('#force-delete-course').on('show.bs.modal', function (event) {
      var button = $(event.relatedTarget)
      switch (button[0].tagName) {
        case 'A':
          btnDelete.onclick = function (e) {
            e.preventDefault();
            courseId = button.data('id');
            forceDeleteForm.action = '/courses/' + courseId + '/delete/force?_method=DELETE';
            forceDeleteForm.submit()
          };
        case 'BUTTON':
          if (btnDelete)
            btnDelete.onclick = function (e) {
              form.submit()
            }
        default:

      }

    })
    restoreBtn.click(function (e) {
      e.preventDefault();
      courseId = $(this).data('id');
      restoreForm.action = '/courses/' + courseId + '/restore?_method=PATCH';
      restoreForm.submit()
    });

    checkboxAll.change(function () {
      var isCheckedAll = $(this).prop('checked')
      courseItemCheckbox.prop('checked', isCheckedAll)
      renderCheckAllSubmitBtn()

    })

    //checkbox item changed
    courseItemCheckbox.change(function () {
      var isCheckedAll = $('input[name="courseIds[]"]:checked').length === courseItemCheckbox.length
      checkboxAll.prop('checked', isCheckedAll)
      renderCheckAllSubmitBtn()

    })
    // disabled btn 
    function renderCheckAllSubmitBtn() {
      var checkCount = $('input[name="courseIds[]"]:checked').length
      if (checkCount > 0) {
        activeBtn.removeClass('disabled')
      }
      else {
        activeBtn.addClass('disabled')

      }
    }
    console.log(form)
  })

</script>